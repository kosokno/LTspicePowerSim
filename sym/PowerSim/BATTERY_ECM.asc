Version 4.1
SHEET 1 1876 1176
WIRE 48 -176 0 -176
WIRE 192 -176 112 -176
WIRE 192 -160 192 -176
WIRE 656 -128 624 -128
WIRE 768 -128 720 -128
WIRE -288 -64 -384 -64
WIRE -192 -64 -288 -64
WIRE 192 -64 192 -80
WIRE -384 -32 -384 -64
WIRE -192 -32 -192 -64
WIRE 416 -16 304 -16
WIRE 624 -16 624 -128
WIRE 624 -16 496 -16
WIRE 656 -16 624 -16
WIRE 768 -16 768 -128
WIRE 768 -16 736 -16
WIRE 864 -16 768 -16
WIRE 960 -16 864 -16
WIRE -288 32 -288 -64
WIRE -384 64 -384 48
WIRE 304 64 304 -16
WIRE 416 64 304 64
WIRE 304 80 304 64
WIRE 864 80 864 -16
WIRE -288 128 -288 96
WIRE -288 128 -368 128
WIRE -192 128 -192 48
WIRE -192 128 -288 128
WIRE -32 128 -192 128
WIRE 160 128 128 128
WIRE -288 160 -288 128
WIRE -192 160 -192 128
WIRE 304 240 304 160
WIRE 864 240 864 144
WIRE 864 240 304 240
WIRE 960 240 864 240
WIRE -288 256 -288 224
WIRE -192 256 -192 224
FLAG -192 256 0
FLAG 160 128 soc
IOPIN 160 128 Out
FLAG -384 64 0
FLAG 416 64 voc
IOPIN 416 64 Out
FLAG 960 240 neg
IOPIN 960 240 BiDir
FLAG 960 -16 pos
IOPIN 960 -16 BiDir
FLAG -368 128 a
FLAG -288 256 0
FLAG 0 -176 ichg
FLAG 192 -64 0
SYMBOL cap -208 160 R0
SYMATTR InstName C1
SYMATTR Value {Cnom}
SYMATTR SpiceLine Rpar=10000Gig
SYMBOL bi -192 -32 R0
SYMATTR InstName B1
SYMATTR Value I=I(R1)*acc
SYMBOL voltage -384 -48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 1
SYMBOL bv 304 64 R0
SYMATTR InstName B2
SYMATTR Value V = s * Voc(V(soc))
SYMBOL res 512 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {resr}
SYMBOL res 752 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {rpar}
SYMBOL cap 720 -144 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
WINDOW 39 -39 -19 VBottom 2
SYMATTR InstName C2
SYMATTR Value {cpar}
SYMATTR SpiceLine Rpar={1/(cpar*1e-12)}
SYMBOL PowerSim\\LIMIT 48 128 R0
SYMATTR InstName X1
SYMBOL iD -288 64 R180
SYMATTR InstName X2
SYMATTR Value von=1n ron=1n
SYMBOL iD -288 192 R180
SYMATTR InstName X3
SYMATTR Value von=1n ron=1n
SYMBOL PowerSim\\LPF 80 -176 M0
WINDOW 3 -1 58 Bottom 2
SYMATTR Value f={soc_flt}
SYMATTR InstName X5
SYMBOL bv 192 -176 R0
SYMATTR InstName B3
SYMATTR Value V=I(R1)
SYMBOL cap 848 80 R0
SYMATTR InstName C3
SYMATTR Value {cstray}
TEXT 1184 -264 Left 2 !.func Voc_LFP(x) table(x,\n+ 0.00, 2.75,\n+ 0.005, 2.85,\n+ 0.010, 2.95,\n+ 0.020, 3.05,\n+ 0.030, 3.12,\n+ 0.040, 3.17,\n+ 0.050, 3.20,\n+ 0.060, 3.22,\n+ 0.080, 3.235,\n+ 0.100, 3.245,\n+ 0.120, 3.250,\n+ 0.150, 3.255,\n+ 0.180, 3.258,\n+ 0.200, 3.260,\n+ 0.250, 3.263,\n+ 0.300, 3.265,\n+ 0.350, 3.266,\n+ 0.400, 3.267,\n+ 0.450, 3.268,\n+ 0.500, 3.269,\n+ 0.550, 3.270,\n+ 0.600, 3.271,\n+ 0.650, 3.272,\n+ 0.700, 3.274,\n+ 0.750, 3.276,\n+ 0.800, 3.279,\n+ 0.850, 3.283,\n+ 0.880, 3.288,\n+ 0.900, 3.295,\n+ 0.920, 3.305,\n+ 0.940, 3.325,\n+ 0.950, 3.340,\n+ 0.960, 3.360,\n+ 0.970, 3.395,\n+ 0.980, 3.440,\n+ 0.985, 3.470,\n+ 0.990, 3.500,\n+ 0.995, 3.530,\n+ 1.000, 3.560\n+)
TEXT -384 -392 Left 2 !.param Ah=10\n.param s=1\n.param acc=3600\n.param type=0\n.param soc_init=0
TEXT -120 -392 Left 2 ;Nominal capacity (Ah)\n# of series cells\nsimulation acceleration factor\ncell type 0:NCM(default), 1:LFP\ninitial SoC
TEXT 360 320 Left 2 !.param Ah_ref = 1\n.param resr_ref=50m\n.param cpar_ref=300\n.param rpar_ref=100m
TEXT 360 448 Left 2 !.param resr = s * resr_ref * Ah_ref / Ah\n.param cpar = cpar_ref * Ah / Ah_ref / s\n.param rpar = s * rpar_ref * Ah_ref / Ah
TEXT -312 344 Left 2 !.param Cnom = Ah * 3600
TEXT 1192 -336 Left 2 !.func Voc(x) { if(type==1, Voc_LFP(x), Voc_NMC(x)) }
TEXT 1568 -264 Left 2 !.func Voc_NMC(x) table(x,\n+ 0.00, 3.00,\n+ 0.005, 3.10,\n+ 0.010, 3.20,\n+ 0.020, 3.30,\n+ 0.030, 3.38,\n+ 0.040, 3.44,\n+ 0.050, 3.48,\n+ 0.060, 3.52,\n+ 0.080, 3.58,\n+ 0.100, 3.62,\n+ 0.120, 3.65,\n+ 0.150, 3.68,\n+ 0.180, 3.71,\n+ 0.200, 3.73,\n+ 0.230, 3.75,\n+ 0.260, 3.77,\n+ 0.300, 3.79,\n+ 0.340, 3.81,\n+ 0.380, 3.83,\n+ 0.420, 3.845,\n+ 0.460, 3.86,\n+ 0.500, 3.875,\n+ 0.540, 3.89,\n+ 0.580, 3.905,\n+ 0.620, 3.92,\n+ 0.660, 3.94,\n+ 0.700, 3.96,\n+ 0.740, 3.985,\n+ 0.780, 4.01,\n+ 0.820, 4.04,\n+ 0.850, 4.065,\n+ 0.880, 4.095,\n+ 0.900, 4.11,\n+ 0.920, 4.13,\n+ 0.940, 4.15,\n+ 0.960, 4.17,\n+ 0.970, 4.18,\n+ 0.980, 4.19,\n+ 0.990, 4.205,\n+ 1.000, 4.20\n+)
TEXT -312 384 Left 2 !.ic V(a)={soc_init}
TEXT -400 -464 Left 4 ;BATTERY ECM
TEXT 1656 -440 Left 2 ;2025.12.26
TEXT -72 -104 Left 2 !.param soc_flt=100k
TEXT 800 312 Left 2 !.param cstray = 10n
TEXT 880 168 Left 2 ;*for sim stability
