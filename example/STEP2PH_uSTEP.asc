Version 4.1
SHEET 1 1956 2284
WIRE -624 128 -640 128
WIRE -608 128 -624 128
WIRE -288 128 -304 128
WIRE -272 128 -288 128
WIRE -624 160 -624 128
WIRE -288 160 -288 128
WIRE -672 240 -704 240
WIRE -208 240 -240 240
WIRE -800 256 -848 256
WIRE -64 256 -112 256
WIRE -624 272 -624 256
WIRE -624 272 -704 272
WIRE -288 272 -288 256
WIRE -208 272 -288 272
WIRE -624 304 -624 272
WIRE -576 304 -624 304
WIRE -480 304 -512 304
WIRE -464 304 -480 304
WIRE -352 304 -384 304
WIRE -288 304 -288 272
WIRE -288 304 -352 304
WIRE -848 320 -848 256
WIRE -848 320 -880 320
WIRE -624 320 -624 304
WIRE -288 320 -288 304
WIRE -64 320 -64 256
WIRE -32 320 -64 320
WIRE -976 336 -1040 336
WIRE 96 336 64 336
WIRE 192 336 160 336
WIRE -848 352 -880 352
WIRE -32 352 -64 352
WIRE 528 352 496 352
WIRE -544 368 -544 336
WIRE -672 400 -704 400
WIRE -208 400 -240 400
WIRE 528 400 528 352
WIRE 640 400 528 400
WIRE -1472 416 -1488 416
WIRE -1456 416 -1472 416
WIRE -848 416 -848 352
WIRE -800 416 -848 416
WIRE -64 416 -64 352
WIRE -64 416 -112 416
WIRE -624 432 -624 416
WIRE -624 432 -704 432
WIRE -288 432 -288 416
WIRE -208 432 -288 432
WIRE 640 432 608 432
WIRE -1472 448 -1472 416
WIRE 944 448 864 448
WIRE -624 464 -624 432
WIRE -288 464 -288 432
WIRE 640 464 608 464
WIRE 1152 480 864 480
WIRE 1328 480 1216 480
WIRE 640 496 608 496
WIRE 944 512 864 512
WIRE 640 528 608 528
WIRE -1472 560 -1472 528
WIRE -624 624 -640 624
WIRE -608 624 -624 624
WIRE -288 624 -304 624
WIRE -272 624 -288 624
WIRE -624 656 -624 624
WIRE -288 656 -288 624
WIRE -672 736 -704 736
WIRE -208 736 -240 736
WIRE -800 752 -848 752
WIRE -64 752 -112 752
WIRE -624 768 -624 752
WIRE -624 768 -704 768
WIRE -288 768 -288 752
WIRE -208 768 -288 768
WIRE -624 800 -624 768
WIRE -576 800 -624 800
WIRE -480 800 -512 800
WIRE -464 800 -480 800
WIRE -352 800 -384 800
WIRE -288 800 -288 768
WIRE -288 800 -352 800
WIRE -848 816 -848 752
WIRE -848 816 -880 816
WIRE -624 816 -624 800
WIRE -288 816 -288 800
WIRE -64 816 -64 752
WIRE -32 816 -64 816
WIRE -1376 832 -1408 832
WIRE -976 832 -1040 832
WIRE 96 832 64 832
WIRE 192 832 160 832
WIRE -1568 848 -1648 848
WIRE -848 848 -880 848
WIRE -32 848 -64 848
WIRE -1376 864 -1408 864
WIRE -544 864 -544 832
WIRE -672 896 -704 896
WIRE -208 896 -240 896
WIRE -848 912 -848 848
WIRE -800 912 -848 912
WIRE -64 912 -64 848
WIRE -64 912 -112 912
WIRE -624 928 -624 912
WIRE -624 928 -704 928
WIRE -288 928 -288 912
WIRE -208 928 -288 928
WIRE -624 960 -624 928
WIRE -288 960 -288 928
WIRE 464 1168 432 1168
WIRE 608 1168 528 1168
WIRE 944 1168 688 1168
WIRE -1056 1200 -1088 1200
WIRE -912 1200 -992 1200
WIRE -576 1200 -832 1200
WIRE -128 1200 -176 1200
WIRE -48 1200 -64 1200
WIRE 608 1200 576 1200
WIRE 800 1200 688 1200
WIRE 944 1200 896 1200
WIRE 1088 1200 1040 1200
WIRE -1648 1232 -1696 1232
WIRE -1568 1232 -1584 1232
WIRE -912 1232 -944 1232
WIRE -720 1232 -832 1232
WIRE -576 1232 -624 1232
WIRE -432 1232 -480 1232
WIRE 800 1232 800 1200
WIRE 944 1232 800 1232
WIRE -720 1264 -720 1232
WIRE -576 1264 -720 1264
WIRE -176 1280 -176 1200
WIRE -16 1280 -176 1280
WIRE 192 1280 -16 1280
WIRE -1696 1312 -1696 1232
WIRE -1536 1312 -1696 1312
WIRE -1328 1312 -1536 1312
WIRE 192 1312 128 1312
WIRE 448 1312 288 1312
WIRE 576 1328 576 1200
WIRE 576 1328 528 1328
WIRE -1328 1344 -1392 1344
WIRE -1072 1344 -1232 1344
WIRE -176 1344 -176 1280
WIRE -16 1344 -16 1280
WIRE 16 1344 -16 1344
WIRE 192 1344 80 1344
WIRE 448 1344 384 1344
WIRE -944 1360 -944 1232
WIRE -944 1360 -992 1360
WIRE -1696 1376 -1696 1312
WIRE -1536 1376 -1536 1312
WIRE -1504 1376 -1536 1376
WIRE -1328 1376 -1440 1376
WIRE -1072 1376 -1136 1376
WIRE -176 1456 -176 1424
WIRE -1696 1488 -1696 1456
WIRE -16 1520 -96 1520
WIRE 192 1520 -16 1520
WIRE -1536 1552 -1616 1552
WIRE -1328 1552 -1536 1552
WIRE 192 1552 128 1552
WIRE 384 1552 384 1344
WIRE 384 1552 288 1552
WIRE -1328 1584 -1392 1584
WIRE -1136 1584 -1136 1376
WIRE -1136 1584 -1232 1584
WIRE -16 1584 -16 1520
WIRE 16 1584 -16 1584
WIRE 192 1584 80 1584
WIRE -1536 1616 -1536 1552
WIRE -1504 1616 -1536 1616
WIRE -1328 1616 -1440 1616
WIRE -1536 1888 -1616 1888
WIRE -1440 1888 -1536 1888
WIRE -1296 1888 -1376 1888
WIRE -1120 1888 -1200 1888
WIRE -960 1888 -1024 1888
FLAG 944 512 theta
FLAG -624 464 0
FLAG -480 304 A
FLAG 608 464 Ax
FLAG 608 528 Bx
FLAG -624 128 VM
FLAG -288 464 0
FLAG -352 304 Ax
FLAG -288 128 VM
FLAG -1040 336 PWMA
FLAG 192 336 PWMA
FLAG 944 448 torque
FLAG -624 960 0
FLAG -480 800 B
FLAG -624 624 VM
FLAG -288 960 0
FLAG -352 800 Bx
FLAG -288 624 VM
FLAG -1040 832 PWMB
FLAG 192 832 PWMB
FLAG -1472 560 0
FLAG -1472 416 VM
FLAG -544 368 IA
FLAG -544 864 IB
FLAG -1696 1488 0
FLAG -432 1232 PWMA
FLAG -1568 1232 zda
FLAG -1616 1552 IA
FLAG -1392 1584 zda
FLAG -1392 1344 zda
FLAG -1376 832 clka
FLAG -1088 1200 clka
FLAG -624 1232 zda
FLAG -176 1456 0
FLAG 1088 1200 PWMb
FLAG -48 1200 zdb
FLAG -96 1520 IB
FLAG 128 1552 zdb
FLAG 128 1312 zdb
FLAG 432 1168 clkb
FLAG 896 1200 zdb
FLAG -1376 864 clkb
FLAG -960 1888 cnt
FLAG 608 432 A
FLAG 608 496 B
FLAG -1536 1888 rpm_cmd
FLAG 1328 480 rpm
SYMBOL CONST 464 352 R0
WINDOW 39 -3 55 Bottom 2
SYMATTR SpiceLine K=0
SYMATTR InstName X2
SYMBOL iGD -752 256 R0
SYMATTR InstName X5
SYMBOL iGD -752 416 R0
SYMATTR InstName X6
SYMBOL DEADTIME -928 336 R0
SYMATTR InstName X7
SYMBOL iGD -160 256 M0
SYMATTR InstName X10
SYMBOL iGD -160 416 M0
SYMATTR InstName X11
SYMBOL DEADTIME 16 336 M0
SYMATTR InstName X12
SYMBOL Digital\\inv 160 272 M0
WINDOW 3 -21 103 Left 2
SYMATTR InstName A1
SYMBOL iGD -752 752 R0
SYMATTR InstName X15
SYMBOL iGD -752 912 R0
SYMATTR InstName X16
SYMBOL DEADTIME -928 832 R0
SYMATTR InstName X17
SYMBOL iGD -160 752 M0
SYMATTR InstName X20
SYMBOL iGD -160 912 M0
SYMATTR InstName X21
SYMBOL DEADTIME 16 832 M0
SYMATTR InstName X22
SYMBOL voltage -1472 432 R0
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL IMON -544 304 R0
SYMATTR InstName X23
SYMBOL IMON -544 800 R0
SYMATTR InstName X24
SYMBOL SRFF -880 1216 R0
SYMATTR InstName X25
SYMBOL CMP -1024 1360 R0
WINDOW 39 0 67 Bottom 2
SYMATTR SpiceLine hys=1u
SYMATTR InstName X26
SYMBOL POSEDGE -1024 1200 R0
WINDOW 39 5 51 Bottom 2
SYMATTR SpiceLine TD=10n
SYMATTR InstName X28
SYMBOL GAIN -1472 1616 R0
WINDOW 39 3 58 Bottom 2
SYMATTR SpiceLine G=-1
SYMATTR InstName X32
SYMBOL MUX -1280 1584 R0
SYMATTR InstName X33
SYMBOL GAIN -1472 1376 R0
WINDOW 39 3 58 Bottom 2
SYMATTR SpiceLine G=-1
SYMATTR InstName X34
SYMBOL MUX -1280 1344 R0
SYMATTR InstName X35
SYMBOL MUX -528 1232 R0
SYMATTR InstName X27
SYMBOL SRFF 640 1184 R0
SYMATTR InstName X36
SYMBOL CMP 496 1328 R0
WINDOW 39 -3 64 Bottom 2
SYMATTR SpiceLine hys=1u
SYMATTR InstName X37
SYMBOL POSEDGE 496 1168 R0
WINDOW 39 5 51 Bottom 2
SYMATTR SpiceLine TD=10n
SYMATTR InstName X38
SYMBOL GAIN 48 1584 R0
WINDOW 39 3 58 Bottom 2
SYMATTR SpiceLine G=-1
SYMATTR InstName X41
SYMBOL MUX 240 1552 R0
SYMATTR InstName X42
SYMBOL GAIN 48 1344 R0
WINDOW 39 3 58 Bottom 2
SYMATTR SpiceLine G=-1
SYMATTR InstName X43
SYMBOL MUX 240 1312 R0
SYMATTR InstName X44
SYMBOL MUX 992 1200 R0
SYMATTR InstName X45
SYMBOL CONST -1680 848 R0
WINDOW 39 4 57 Bottom 2
SYMATTR SpiceLine K=20
SYMATTR InstName X46
SYMBOL bv -1696 1360 R0
SYMATTR InstName B1
SYMATTR Value V={Idrv}*sin(V(cnt)*PI/128)
SYMBOL bv -176 1328 R0
SYMATTR InstName B2
SYMATTR Value V={Idrv}*cos(V(cnt)*PI/128)
SYMBOL CONST -1648 1888 R0
WINDOW 39 7 57 Bottom 2
SYMATTR SpiceLine K=60
SYMATTR InstName X52
SYMBOL Digital\\inv 160 768 M0
WINDOW 3 -21 103 Left 2
SYMATTR InstName A2
SYMBOL VCO -1248 1888 R0
SYMATTR InstName X39
SYMBOL COUNTER -1072 1888 R0
WINDOW 123 7 64 Bottom 2
WINDOW 39 -46 94 Bottom 2
WINDOW 40 66 95 Bottom 2
SYMATTR InstName X1
SYMBOL GAIN 1184 480 R0
WINDOW 39 23 64 Bottom 2
SYMATTR SpiceLine G={1/(2*PI)*60}
SYMATTR InstName X47
SYMBOL GAIN -1408 1888 R0
WINDOW 39 -8 62 Bottom 2
SYMATTR SpiceLine G={256*{p}/60}
SYMATTR InstName X49
SYMBOL PHASESHIFT -1488 848 R0
WINDOW 39 0 72 Bottom 2
SYMATTR SpiceLine freq=50k
SYMATTR InstName X50
SYMBOL STEPPER_2PH 752 464 R0
WINDOW 3 -60 121 Bottom 2
WINDOW 123 -6 152 Bottom 2
WINDOW 39 -11 186 Bottom 2
WINDOW 40 43 124 Bottom 2
WINDOW 0 -10 -99 Bottom 2
SYMATTR Value p={p}
SYMATTR InstName X29
SYMBOL ZCD -1616 1232 R0
WINDOW 39 8 58 Bottom 2
SYMATTR SpiceLine hys=10u
SYMATTR InstName X30
SYMBOL ZCD -96 1200 R0
WINDOW 39 8 58 Bottom 2
SYMATTR SpiceLine hys=10u
SYMATTR InstName X3
SYMBOL iNMOS -624 208 R0
SYMATTR InstName X4
SYMBOL iNMOS -624 368 R0
SYMATTR InstName X8
SYMBOL iNMOS -288 208 M0
SYMATTR InstName X9
SYMBOL iNMOS -288 368 M0
SYMATTR InstName X13
SYMBOL iNMOS -288 704 M0
SYMATTR InstName X14
SYMBOL iNMOS -288 864 M0
SYMATTR InstName X18
SYMBOL iNMOS -624 704 R0
SYMATTR InstName X19
SYMBOL iNMOS -624 864 R0
SYMATTR InstName X31
TEXT -1744 96 Left 2 !.tran 0 300m 0
TEXT -1744 -8 Left 2 !.options solver="norm"\n.options method="gear"
TEXT -1392 1112 Left 2 !.param Idrv=5
TEXT -1736 224 Left 2 !.options debugtran
TEXT 872 344 Left 2 !.param p=50
TEXT -1768 -120 Left 6 ;2 Phase Stepper Motor, 256 micro step open loop control
TEXT 400 40 Left 4 ;Stepper Motor
TEXT 1200 -96 Left 2 ;2025.07.21
TEXT -1200 72 Left 4 ;Power Stage
TEXT -1776 664 Left 4 ;Clock
TEXT -1776 376 Left 4 ;Power
TEXT -1768 1104 Left 4 ;Micro step control
RECTANGLE Normal 352 1024 -1216 16 2
RECTANGLE Normal -1264 1024 -1792 640 2
RECTANGLE Normal 1488 1024 384 16 2
RECTANGLE Normal -1264 592 -1792 352 2
RECTANGLE Normal 1488 2000 -1792 1072 2
