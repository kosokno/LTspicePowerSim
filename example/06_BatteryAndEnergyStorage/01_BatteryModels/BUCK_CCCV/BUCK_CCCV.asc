Version 4.1
SHEET 1 1764 1444
WIRE 560 256 224 256
WIRE 608 256 560 256
WIRE 224 288 224 256
WIRE 608 336 608 256
WIRE 224 400 224 368
WIRE 560 416 528 416
WIRE 432 432 368 432
WIRE 608 448 608 432
WIRE 608 448 528 448
WIRE 816 448 816 432
WIRE 1008 448 1008 432
WIRE 608 480 608 448
WIRE 640 480 608 480
WIRE 688 480 640 480
WIRE 784 480 768 480
WIRE 864 480 848 480
WIRE 944 480 864 480
WIRE 976 480 944 480
WIRE 1136 480 1040 480
WIRE 1136 512 1136 480
WIRE 608 528 608 480
WIRE 864 528 864 480
WIRE 1216 576 1184 576
WIRE 1216 608 1184 608
WIRE 608 672 608 592
WIRE 864 672 864 592
WIRE 1136 688 1136 672
WIRE -32 880 -64 880
WIRE 80 880 32 880
WIRE 176 880 80 880
WIRE 448 896 400 896
WIRE 576 896 448 896
WIRE 1072 896 1040 896
WIRE 1200 896 1168 896
WIRE 1312 896 1264 896
WIRE 1328 896 1312 896
WIRE 1472 896 1408 896
WIRE 176 912 128 912
WIRE 1312 928 1296 928
WIRE 1328 928 1312 928
WIRE 672 944 624 944
WIRE 768 944 736 944
WIRE 128 976 128 912
WIRE 128 976 80 976
WIRE 576 1024 576 896
WIRE 624 1024 624 944
WIRE 624 1024 576 1024
WIRE 672 1024 624 1024
WIRE 768 1040 768 944
WIRE 768 1040 736 1040
WIRE 848 1040 768 1040
WIRE 1168 1040 848 1040
WIRE 624 1056 576 1056
WIRE 672 1056 624 1056
WIRE 1296 1056 1296 928
WIRE 1296 1056 1248 1056
WIRE 1168 1072 1136 1072
WIRE 1056 1104 1040 1104
WIRE 1136 1104 1136 1072
WIRE 1136 1104 1120 1104
WIRE 624 1136 624 1056
WIRE 672 1136 624 1136
WIRE 768 1136 768 1040
WIRE 768 1136 736 1136
WIRE -32 1152 -48 1152
WIRE 80 1152 32 1152
WIRE 176 1152 80 1152
WIRE 448 1168 400 1168
WIRE 576 1168 576 1056
WIRE 576 1168 448 1168
WIRE 176 1184 128 1184
WIRE 976 1184 944 1184
WIRE 1088 1184 1088 1136
WIRE 1088 1184 1040 1184
WIRE 128 1248 128 1184
WIRE 128 1248 80 1248
FLAG 608 672 0
FLAG 224 400 0
FLAG 864 672 0
FLAG 944 480 out
FLAG 560 256 in
FLAG 640 480 sw
FLAG 448 896 vc_v
FLAG 1472 896 pwm
FLAG 816 432 IL
FLAG 1040 1104 IL
FLAG 1312 896 s
FLAG 1312 928 r
FLAG 944 1184 pwm
FLAG 1088 1184 slope
FLAG -64 880 out
FLAG 1136 688 0
FLAG 1216 576 soc
FLAG 1216 608 voc
FLAG 448 1168 vc_i
FLAG -48 1152 Ichg
FLAG 1008 432 Ichg
FLAG 80 880 out_f
FLAG 80 1152 Ichg_f
FLAG 848 1040 vc
FLAG 368 432 pwm
SYMBOL voltage 224 272 R0
WINDOW 0 -50 2 Top 2
WINDOW 3 -92 108 Bottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {5*cell_cnt}
SYMBOL ind 672 496 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=1m
SYMBOL cap 848 528 R0
SYMATTR InstName C1
SYMATTR Value 22µ
SYMATTR SpiceLine Rser=1m
SYMBOL iGD 480 432 R0
SYMATTR InstName X2
SYMBOL IMON 816 480 M180
SYMATTR InstName X4
SYMBOL VCO 1120 896 R0
SYMATTR InstName X6
SYMBOL POSEDGE 1232 896 R0
WINDOW 39 5 51 Bottom 2
SYMATTR SpiceLine TD=10n
SYMATTR InstName X7
SYMBOL CONST 1008 896 R0
WINDOW 39 0 51 Bottom 2
SYMATTR SpiceLine K=1Meg
SYMATTR InstName X8
SYMBOL CMP 1216 1056 R0
SYMATTR InstName X9
SYMBOL SRFF 1360 912 R0
SYMATTR InstName X11
SYMBOL SLOPE 1008 1184 R0
WINDOW 39 92 60 Bottom 2
SYMATTR SpiceLine Se={((5-3.5)*cell_cnt/10u)*0.1}
SYMATTR InstName X12
SYMBOL CONST 48 976 R0
WINDOW 39 6 57 Bottom 2
SYMATTR SpiceLine K={4.2*cell_cnt}
SYMATTR InstName X14
SYMBOL SUM 1088 1104 R0
SYMATTR InstName X5
SYMBOL iNMOS 608 384 R0
SYMATTR InstName X10
SYMBOL PowerSim\\BATTERY_ECM 1136 592 R0
WINDOW 3 229 79 Bottom 2
WINDOW 123 144 110 Bottom 2
WINDOW 40 143 140 Bottom 2
SYMATTR Value Ah={cell_Ah} s={cell_cnt}
SYMATTR Value2 soc_init=0.8
SYMATTR SpiceLine2 acc=36000
SYMATTR InstName X16
SYMBOL CONST 48 1248 R0
WINDOW 39 0 51 Bottom 2
SYMATTR SpiceLine K={cell_Ah}
SYMATTR InstName X18
SYMBOL IMON 1008 480 M180
SYMATTR InstName X19
SYMBOL PowerSim\\MIN 704 1040 R0
SYMATTR InstName X20
SYMBOL iD 608 560 R180
SYMATTR InstName X1
SYMBOL PowerSim\\LPF 0 880 R0
WINDOW 3 3 51 Bottom 2
SYMATTR Value f=500k
SYMATTR InstName X3
SYMBOL PowerSim\\LPF 0 1152 R0
WINDOW 3 3 51 Bottom 2
SYMATTR Value f=500k
SYMATTR InstName X15
SYMBOL iD 704 944 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName X21
SYMBOL iD 704 1136 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName X22
SYMBOL PowerSim\\TYPE2_gm 288 896 R0
WINDOW 39 -6 70 Bottom 2
WINDOW 40 -7 97 Bottom 2
SYMATTR SpiceLine g=6 fz1=5k fp1=200k
SYMATTR SpiceLine2 vh={1.5*cell_Ah} vl=0
SYMATTR InstName X23
SYMBOL PowerSim\\TYPE2_gm 288 1168 R0
WINDOW 39 -6 70 Bottom 2
WINDOW 40 8 97 Bottom 2
SYMATTR SpiceLine g=1 fz1=1k fp1=20k
SYMATTR SpiceLine2 vh={1.5*cell_Ah} vl=0
SYMATTR InstName X24
TEXT 320 160 Left 2 !.tran 25m
TEXT -304 64 Left 6 ;CC-CV Buck Charger
TEXT 1344 120 Left 2 ;2025-12-26
TEXT -248 160 Left 2 !.options solver="norm"\n.options method="gear"
TEXT -136 816 Left 2 ;Voltage loop
TEXT -136 1088 Left 2 ;Current loop
TEXT 888 816 Left 2 ;Peak Current Mode Control
TEXT 1248 448 Left 2 !.param cell_Ah=200\n.param cell_cnt=16
TEXT 1240 416 Left 2 ;Cell Configuration
RECTANGLE Normal 496 1040 -144 800 2
RECTANGLE Normal 496 1312 -144 1072 2
RECTANGLE Normal 1552 1312 880 800 2
RECTANGLE Normal 1504 496 1232 432 2
