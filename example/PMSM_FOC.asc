Version 4.1
SHEET 1 5496 2604
WIRE 3088 -96 3072 -96
WIRE 3104 -96 3088 -96
WIRE 3088 -64 3088 -96
WIRE 3728 0 3712 0
WIRE 3744 0 3728 0
WIRE 3040 16 3008 16
WIRE 2912 32 2864 32
WIRE 3728 32 3728 0
WIRE 3088 48 3088 32
WIRE 3088 48 3008 48
WIRE 3088 80 3088 48
WIRE 3136 80 3088 80
WIRE 3232 80 3200 80
WIRE 3248 80 3232 80
WIRE 2864 96 2864 32
WIRE 2864 96 2832 96
WIRE 3088 96 3088 80
WIRE 2736 112 2672 112
WIRE 2864 128 2832 128
WIRE 4240 128 4208 128
WIRE 3168 144 3168 112
WIRE 3728 144 3728 112
WIRE 3040 176 3008 176
WIRE 4240 176 4240 128
WIRE 4352 176 4240 176
WIRE 2864 192 2864 128
WIRE 2912 192 2864 192
WIRE 3088 208 3088 192
WIRE 3088 208 3008 208
WIRE 4352 208 4320 208
WIRE 4656 224 4576 224
WIRE 3088 240 3088 208
WIRE 4352 240 4320 240
WIRE 4864 256 4576 256
WIRE 5040 256 4928 256
WIRE 4352 272 4320 272
WIRE 4624 288 4576 288
WIRE 4656 288 4624 288
WIRE 4352 304 4320 304
WIRE 3088 400 3072 400
WIRE 3104 400 3088 400
WIRE 3840 400 3824 400
WIRE 3856 400 3840 400
WIRE 3088 432 3088 400
WIRE 3840 432 3840 400
WIRE 4624 448 4624 288
WIRE 4704 448 4624 448
WIRE 5056 448 4768 448
WIRE 3040 512 3008 512
WIRE 3792 512 3760 512
WIRE 2912 528 2864 528
WIRE 3664 528 3616 528
WIRE 3088 544 3088 528
WIRE 3088 544 3008 544
WIRE 3840 544 3840 528
WIRE 3840 544 3760 544
WIRE 3088 576 3088 544
WIRE 3136 576 3088 576
WIRE 3232 576 3200 576
WIRE 3248 576 3232 576
WIRE 3840 576 3840 544
WIRE 3888 576 3840 576
WIRE 3984 576 3952 576
WIRE 4000 576 3984 576
WIRE 2864 592 2864 528
WIRE 2864 592 2832 592
WIRE 3088 592 3088 576
WIRE 3616 592 3616 528
WIRE 3616 592 3584 592
WIRE 3840 592 3840 576
WIRE 2736 608 2672 608
WIRE 3488 608 3424 608
WIRE 2864 624 2832 624
WIRE 3616 624 3584 624
WIRE 3168 640 3168 608
WIRE 3920 640 3920 608
WIRE 3040 672 3008 672
WIRE 3792 672 3760 672
WIRE 2864 688 2864 624
WIRE 2912 688 2864 688
WIRE 3616 688 3616 624
WIRE 3664 688 3616 688
WIRE 3088 704 3088 688
WIRE 3088 704 3008 704
WIRE 3840 704 3840 688
WIRE 3840 704 3760 704
WIRE 3088 736 3088 704
WIRE 3840 736 3840 704
WIRE 2960 896 2912 896
WIRE 3056 896 3024 896
WIRE 3056 976 3056 896
WIRE 3120 976 3056 976
WIRE 3328 992 3248 992
WIRE 3520 992 3328 992
WIRE 2960 1008 2912 1008
WIRE 3120 1008 3024 1008
WIRE 3328 1024 3248 1024
WIRE 3120 1040 3056 1040
WIRE 3936 1056 3248 1056
WIRE 3120 1072 3088 1072
WIRE 2960 1120 2912 1120
WIRE 3056 1120 3056 1040
WIRE 3056 1120 3024 1120
WIRE 4208 1120 4160 1120
WIRE 4368 1120 4272 1120
WIRE 4448 1120 4432 1120
WIRE 3088 1168 3088 1072
WIRE 3520 1168 3520 992
WIRE 3584 1168 3520 1168
WIRE 4240 1168 4240 1152
WIRE 4240 1168 4192 1168
WIRE 4400 1168 4400 1152
WIRE 4400 1168 4352 1168
WIRE 3904 1184 3808 1184
WIRE 3968 1184 3904 1184
WIRE 3504 1200 3456 1200
WIRE 3584 1200 3504 1200
WIRE 4128 1200 4096 1200
WIRE 4160 1200 4160 1120
WIRE 4160 1200 4128 1200
WIRE 4448 1200 4448 1120
WIRE 4480 1200 4448 1200
WIRE 4512 1200 4480 1200
WIRE 4752 1200 4672 1200
WIRE 3904 1216 3888 1216
WIRE 3968 1216 3904 1216
WIRE 4128 1232 4096 1232
WIRE 4208 1232 4128 1232
WIRE 4368 1232 4272 1232
WIRE 4480 1232 4432 1232
WIRE 4512 1232 4480 1232
WIRE 4752 1232 4672 1232
WIRE 3936 1248 3936 1056
WIRE 3968 1248 3936 1248
WIRE 4128 1264 4096 1264
WIRE 4160 1264 4128 1264
WIRE 4400 1264 4400 1248
WIRE 4480 1264 4448 1264
WIRE 4512 1264 4480 1264
WIRE 4752 1264 4672 1264
WIRE 3968 1280 3936 1280
WIRE 4192 1280 4192 1168
WIRE 4240 1280 4240 1264
WIRE 4240 1280 4192 1280
WIRE 4352 1280 4352 1168
WIRE 4400 1280 4400 1264
WIRE 4400 1280 4352 1280
WIRE 4560 1312 4560 1296
WIRE 4592 1312 4592 1296
WIRE 4624 1312 4624 1296
WIRE 4160 1344 4160 1264
WIRE 4208 1344 4160 1344
WIRE 4368 1344 4272 1344
WIRE 4448 1344 4448 1264
WIRE 4448 1344 4432 1344
WIRE 2928 1360 2752 1360
WIRE 3328 1408 3328 1024
WIRE 3584 1408 3328 1408
WIRE 4192 1408 4192 1280
WIRE 4240 1408 4240 1376
WIRE 4240 1408 4192 1408
WIRE 4352 1408 4352 1280
WIRE 4400 1408 4400 1376
WIRE 4400 1408 4352 1408
WIRE 2928 1424 2928 1360
WIRE 3024 1424 2928 1424
WIRE 3888 1424 3888 1216
WIRE 3888 1424 3808 1424
WIRE 3936 1424 3936 1280
WIRE 3504 1440 3248 1440
WIRE 3584 1440 3504 1440
WIRE 2896 1456 2704 1456
WIRE 3024 1456 2896 1456
WIRE 2704 1472 2704 1456
WIRE 4192 1488 4192 1408
WIRE 4192 1488 4160 1488
WIRE 4352 1488 4352 1408
WIRE 4352 1488 4320 1488
WIRE 2704 1568 2704 1552
FLAG 3504 1200 id_ref
FLAG 3328 992 id
FLAG 3328 1024 iq
FLAG 3088 1168 theta_e
FLAG 3936 1424 theta_e
FLAG 4656 288 theta
FLAG 3088 240 0
FLAG 3232 80 A
FLAG 4320 240 B
FLAG 3088 -96 VM
FLAG 2672 112 PWMA
FLAG 4656 224 torque
FLAG 3088 736 0
FLAG 3232 576 B
FLAG 3088 400 VM
FLAG 2672 608 PWMB
FLAG 3728 144 0
FLAG 3728 0 VM
FLAG 3168 144 IA
FLAG 3168 640 IB
FLAG 4320 208 A
FLAG 4320 272 C
FLAG 5040 256 rpm
FLAG 2912 896 IA
FLAG 2912 1008 IB
FLAG 3904 1184 ud
FLAG 3904 1216 uq
FLAG 2896 1456 rpm_ref
FLAG 2752 1360 rpm
FLAG 3504 1440 iq_ref
FLAG 3840 736 0
FLAG 3984 576 C
FLAG 3840 400 VM
FLAG 3424 608 PWMC
FLAG 3920 640 IC
FLAG 4752 1200 PWMA
FLAG 4752 1232 PWMB
FLAG 4752 1264 PWMC
FLAG 2912 1120 IC
FLAG 4128 1200 ua
FLAG 4128 1232 ub
FLAG 4128 1264 uc
FLAG 4480 1200 da
FLAG 4480 1232 db
FLAG 4480 1264 dc
FLAG 5056 448 theta_e
FLAG 4560 1312 da_
FLAG 4592 1312 db_
FLAG 4624 1312 dc_
FLAG 2704 1568 0
SYMBOL CONST 4176 128 R0
WINDOW 39 -3 55 Bottom 2
SYMATTR SpiceLine K=0
SYMATTR InstName X1
SYMBOL iGD 2960 32 R0
SYMATTR InstName X2
SYMBOL iGD 2960 192 R0
SYMATTR InstName X3
SYMBOL DEADTIME 2784 112 R0
SYMATTR InstName X4
SYMBOL iGD 2960 528 R0
SYMATTR InstName X11
SYMBOL iGD 2960 688 R0
SYMATTR InstName X15
SYMBOL DEADTIME 2784 608 R0
SYMATTR InstName X16
SYMBOL voltage 3728 16 R0
SYMATTR InstName V1
SYMATTR Value {Vdrv}
SYMBOL IMON 3168 80 R0
SYMATTR InstName X32
SYMBOL IMON 3168 576 R0
SYMATTR InstName X35
SYMBOL GAIN 4896 256 R0
WINDOW 39 23 64 Bottom 2
SYMATTR SpiceLine G={1/(2*PI)*60}
SYMATTR InstName X37
SYMBOL iNMOS 3088 -16 R0
SYMATTR InstName X42
SYMBOL iNMOS 3088 144 R0
SYMATTR InstName X59
SYMBOL iNMOS 3088 480 R0
SYMATTR InstName X64
SYMBOL iNMOS 3088 640 R0
SYMATTR InstName X65
SYMBOL LPF 2992 896 R0
WINDOW 3 5 53 Bottom 2
SYMATTR Value f=10k
SYMATTR InstName X21
SYMBOL TYPE2_gm 3136 1440 R0
WINDOW 39 7 70 Bottom 2
WINDOW 40 -6 96 Bottom 2
SYMATTR SpiceLine g=10m fz1=2 fp1=10k
SYMATTR SpiceLine2 vh=30 vl=-30
SYMATTR InstName X30
SYMBOL TYPE2_gm 3696 1184 R0
WINDOW 39 3 69 Bottom 2
WINDOW 40 -9 99 Bottom 2
SYMATTR SpiceLine g=0.5 fz1=100 fp1=20k
SYMATTR SpiceLine2 vh={Vclmp} vl={-Vclmp}
SYMATTR InstName X20
SYMBOL TYPE2_gm 3696 1424 R0
WINDOW 39 12 72 Bottom 2
WINDOW 40 10 99 Bottom 2
SYMATTR SpiceLine g=0.5 fz1=100 fp1=20k
SYMATTR SpiceLine2 vh={Vclmp} vl={-Vclmp}
SYMATTR InstName X5
SYMBOL LPF 2992 1008 R0
WINDOW 3 3 49 Bottom 2
SYMATTR Value f=10k
SYMATTR InstName X6
SYMBOL PMSM 4464 240 R0
WINDOW 3 -8 116 Bottom 2
WINDOW 123 0 142 Bottom 2
WINDOW 39 -3 168 Bottom 2
SYMATTR InstName X7
SYMBOL iGD 3712 528 R0
SYMATTR InstName X8
SYMBOL iGD 3712 688 R0
SYMATTR InstName X9
SYMBOL DEADTIME 3536 608 R0
SYMATTR InstName X10
SYMBOL IMON 3920 576 R0
SYMATTR InstName X17
SYMBOL iNMOS 3840 480 R0
SYMATTR InstName X22
SYMBOL iNMOS 3840 640 R0
SYMATTR InstName X26
SYMBOL CLARKE_PARKinv 4032 1232 R0
SYMATTR InstName X12
SYMBOL CLARKE_PARK 3184 1024 R0
SYMATTR InstName X13
SYMBOL SV_PWM 4592 1232 R0
WINDOW 39 8 156 Bottom 2
SYMATTR SpiceLine freq=50k
SYMATTR InstName X14
SYMBOL LPF 2992 1120 R0
WINDOW 3 3 49 Bottom 2
SYMATTR Value f=10k
SYMATTR InstName X18
SYMBOL MUL 4240 1120 R0
SYMATTR InstName X24
SYMBOL MUL 4240 1232 R0
SYMATTR InstName X27
SYMBOL MUL 4240 1344 R0
SYMATTR InstName X28
SYMBOL CONST 4128 1488 R0
WINDOW 39 0 55 Bottom 2
SYMATTR SpiceLine K={1/Vdrv}
SYMATTR InstName X29
SYMBOL SUM 4400 1120 R0
SYMATTR InstName X31
SYMBOL SUM 4400 1232 R0
SYMATTR InstName X33
SYMBOL SUM 4400 1344 R0
SYMATTR InstName X34
SYMBOL CONST 4288 1488 R0
WINDOW 39 6 55 Bottom 2
SYMATTR SpiceLine K=0.5
SYMATTR InstName X23
SYMBOL GAIN 4736 448 R0
WINDOW 39 6 56 Bottom 2
SYMATTR SpiceLine G=4
SYMATTR InstName X40
SYMBOL CONST 3424 1200 R0
WINDOW 39 5 51 Bottom 2
SYMATTR SpiceLine K=0
SYMATTR InstName X25
SYMBOL voltage 2704 1456 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 30 106 Left 2
SYMATTR Value PWL(0 0 10m 0 +1u 100 100m 100 +1u 400 200m 400 +1u 100)
SYMATTR InstName V2
TEXT 2488 -240 Left 2 !.tran 0.3
TEXT 4528 -376 Left 2 !.options solver="norm"\n.options method="gear"
TEXT 2488 -392 Left 6 ;PMSM, FOC (Field Oriented Control)
TEXT 4112 -184 Left 4 ;Motor
TEXT 5072 -392 Left 2 ;2025.09.06
TEXT 2512 -152 Left 4 ;Power Stage
TEXT 3608 1344 Left 2 ;Torque Control
TEXT 3616 1096 Left 2 ;Flux Control
TEXT 2760 -240 Left 2 !;.options debugtran
TEXT 3048 1360 Left 2 ;Velocity Control
TEXT 3640 -88 Left 2 !.param Vdrv=48
TEXT 2520 872 Left 4 ;FOC Control
TEXT 3776 1152 Left 1 ;gm
TEXT 3776 1392 Left 1 ;gm
TEXT 3216 1408 Left 1 ;gm
TEXT 3112 1112 Left 2 ;Clarke-Park
TEXT 3968 1344 Left 2 ;Clarke-Park
TEXT 3984 1320 Left 2 ;Inverse
TEXT 3544 1552 Left 2 !.param Vclmp=Vdrv/sqrt(3)
RECTANGLE Normal 4064 800 2496 -208 2
RECTANGLE Normal 5200 800 4096 -208 2
RECTANGLE Normal 5200 1584 2496 832 2
